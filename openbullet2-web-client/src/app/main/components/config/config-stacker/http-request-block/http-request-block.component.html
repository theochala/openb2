<div class="row mt-1">
    <div class="mb-1">
        <span class="text-small">Label</span>
    </div>
    <app-input-text key="blockLabel"
        class="input-small w-100"
        ngDefaultControl
        (validityChange)="valueChanged()"
        [(ngModel)]="block.label"
        [placeholder]="descriptor.name" />
</div>
<div class="row mt-2">
    <p-checkbox inputId="safeMode"
        class="text-small"
        (onChange)="valueChanged()"
        ngDefaultControl 
        [(ngModel)]="block.safe"
        [binary]="true"
        pTooltip="If safe mode is enabled, any error generated by this block will be caught and written to the data.ERROR variable, without producing an ERROR status in the bot"
        label="Safe Mode" />
</div>
<div class="row mt-3">
    <div class="color-accent-light text-small">
        PARAMETERS
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <span class="text-small">URL</span>
            <app-string-setting
                [parameter]="descriptor.parameters['url']"
                [setting]="block.settings['url']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6 pl-0 pr-1">
        <div class="mb-1">
            <span class="text-small">Method</span>
            <app-enum-setting
                [parameter]="descriptor.parameters['method']"
                [setting]="block.settings['method']"
                (onChange)="valueChanged()" />
        </div>
    </div>
    <div class="col-6 pr-0 pl-1">
        <div class="mb-1">
            <span class="text-small">HTTP version</span>
            <app-string-setting
                [parameter]="descriptor.parameters['httpVersion']"
                [setting]="block.settings['httpVersion']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6 pl-0 pr-1">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['autoRedirect']"
                [setting]="block.settings['autoRedirect']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
    <div class="col-6 pr-0 pl-1">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['alwaysSendContent']"
                [setting]="block.settings['alwaysSendContent']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="d-flex flex-row">
            <div class="d-flex align-items-center mr-2">
                <p-radioButton name="Standard"
                    pTooltip="String request body"
                    [value]="RequestParamsType.Standard"
                    [ngModel]="currentParamsType"
                    (ngModelChange)="paramsTypeChanged($event)"
                    inputId="standardRequestParams"></p-radioButton>
                <label for="standardRequestParams" class="ml-2 text-small">Standard</label>
            </div>
            <div class="d-flex align-items-center mr-2">
                <p-radioButton name="Raw"
                    pTooltip="Raw bytes request body"
                    [value]="RequestParamsType.Raw"
                    [ngModel]="currentParamsType"
                    (ngModelChange)="paramsTypeChanged($event)"
                    inputId="rawRequestParams"></p-radioButton>
                <label for="rawRequestParams" class="ml-2 text-small">Raw</label>
            </div>
            <div class="d-flex align-items-center mr-2">
                <p-radioButton name="Basic Auth"
                    pTooltip="Basic Auth header"
                    [value]="RequestParamsType.BasicAuth"
                    [ngModel]="currentParamsType"
                    (ngModelChange)="paramsTypeChanged($event)"
                    inputId="basicAuthRequestParams"></p-radioButton>
                <label for="basicAuthRequestParams" class="ml-2 text-small">Basic Auth</label>
            </div>
            <div class="d-flex align-items-center mr-2">
                <p-radioButton name="Multipart"
                    pTooltip="Multipart request body"
                    [value]="RequestParamsType.Multipart"
                    [ngModel]="currentParamsType"
                    (ngModelChange)="paramsTypeChanged($event)"
                    inputId="multipartRequestParams"></p-radioButton>
                <label for="multipartRequestParams" class="ml-2 text-small">Multipart</label>
            </div>
        </div>
    </div>
</div>
<ng-container *ngIf="currentParamsType === RequestParamsType.Standard">
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Content</span>
                <app-string-setting
                    [setting]="standardRequestParams.content"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Content Type</span>
                <app-string-setting
                    [setting]="standardRequestParams.contentType"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
</ng-container>
<ng-container *ngIf="currentParamsType === RequestParamsType.Raw">
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Content</span>
                <app-byte-array-setting
                    [setting]="rawRequestParams.content"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Content Type</span>
                <app-string-setting
                    [setting]="rawRequestParams.contentType"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
</ng-container>
<ng-container *ngIf="currentParamsType === RequestParamsType.BasicAuth">
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Username</span>
                <app-string-setting
                    [setting]="basicAuthRequestParams.username"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Password</span>
                <app-string-setting
                    [setting]="basicAuthRequestParams.password"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
</ng-container>
<ng-container *ngIf="currentParamsType === RequestParamsType.Multipart">
    <div class="row mt-2">
        <div class="col-12 px-0">
            <div class="mb-1">
                <span class="text-small">Boundary</span>
                <app-string-setting
                    [setting]="multipartRequestParams.boundary"
                    [stacker]="stacker"
                    (onChange)="valueChanged()" />
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12">
            <div class="multipart-buttons">
                <button class="button button-transparent text-small color-primary" 
                    pTooltip="Add a multipart string content"
                    (click)="addMultipartString()">
                    <fa-icon class="color-good" [icon]="faPlus" [fixedWidth]="true"></fa-icon>
                    String
                </button>
                <button class="button button-transparent text-small color-primary" 
                    pTooltip="Add a multipart raw content"
                    (click)="addMultipartRaw()">
                    <fa-icon class="color-good" [icon]="faPlus" [fixedWidth]="true"></fa-icon>
                    Raw
                </button>
                <button class="button button-transparent text-small color-primary" 
                    pTooltip="Add a multipart file content"
                    (click)="addMultipartFile()">
                    <fa-icon class="color-good" [icon]="faPlus" [fixedWidth]="true"></fa-icon>
                    File
                </button>
            </div>
        </div>
    </div>
    <ng-container *ngFor="let content of multipartRequestParams.contents; let i = index">
        <ng-container *ngIf="content._polyTypeName === MultipartContentType.String">
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">Multipart String Content</span>
                    <button class="button button-transparent" 
                        pTooltip="Remove this content"
                        (click)="removeMultipart(i)">
                        <fa-icon class="color-bad" [icon]="faTimes" [fixedWidth]="true"></fa-icon>
                    </button>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-6 pl-0 pr-1" >
                    <span class="text-small">Name</span>
                    <app-string-setting
                        [setting]="content.name"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
                <div class="col-6 pr-0 pl-1">
                    <span class="text-small">Content Type</span>
                    <app-string-setting
                        [setting]="content.contentType"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">Data</span>
                    <app-string-setting
                        [setting]="content.data"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
        </ng-container>
        <ng-container *ngIf="content._polyTypeName === MultipartContentType.Raw">
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">Multipart Raw Content</span>
                    <button class="button button-transparent" 
                        pTooltip="Remove this content"
                        (click)="removeMultipart(i)">
                        <fa-icon class="color-bad" [icon]="faTimes" [fixedWidth]="true"></fa-icon>
                    </button>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-6 pl-0 pr-1">
                    <span class="text-small">Name</span>
                    <app-string-setting
                        [setting]="content.name"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
                <div class="col-6 pr-0 pl-1">
                    <span class="text-small">Content Type</span>
                    <app-string-setting
                        [setting]="content.contentType"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">Data</span>
                    <app-byte-array-setting
                        [setting]="content.data"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
        </ng-container>
        <ng-container *ngIf="content._polyTypeName === MultipartContentType.File">
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">Multipart File Content</span>
                    <button class="button button-transparent" 
                        pTooltip="Remove this content"
                        (click)="removeMultipart(i)">
                        <fa-icon class="color-bad" [icon]="faTimes" [fixedWidth]="true"></fa-icon>
                    </button>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-6 pl-0 pr-1" >
                    <span class="text-small">Name</span>
                    <app-string-setting
                        [setting]="content.name"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
                <div class="col-6 pr-0 pl-1">
                    <span class="text-small">Content Type</span>
                    <app-string-setting
                        [setting]="content.contentType"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12 px-0">
                    <span class="text-small">File Name</span>
                    <app-string-setting
                        [setting]="content.fileName"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
        </ng-container>
    </ng-container>
</ng-container>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['urlEncodeContent']"
                [setting]="block.settings['urlEncodeContent']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <span class="text-small">Custom Cookies</span>
            <app-dictionary-of-strings-setting
                [parameter]="descriptor.parameters['customCookies']"
                [setting]="block.settings['customCookies']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <span class="text-small">Custom Headers</span>
            <app-dictionary-of-strings-setting
                [parameter]="descriptor.parameters['customHeaders']"
                [setting]="block.settings['customHeaders']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6 pl-0 pr-1">
        <div class="mb-1">
            <span class="text-small">Timeout (ms)</span>
            <app-int-setting
                [parameter]="descriptor.parameters['timeoutMilliseconds']"
                [setting]="block.settings['timeoutMilliseconds']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
    <div class="col-6 pr-0 pl-1">
        <div class="mb-1">
            <span class="text-small">Max n. of redirects</span>
            <app-int-setting
                [parameter]="descriptor.parameters['maxNumberOfRedirects']"
                [setting]="block.settings['maxNumberOfRedirects']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6 pl-0 pr-1">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['absoluteUriInFirstLine']"
                [setting]="block.settings['absoluteUriInFirstLine']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
    <div class="col-6 pr-0 pl-1">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['readResponseContent']"
                [setting]="block.settings['readResponseContent']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['decodeHtml']"
                [setting]="block.settings['decodeHtml']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <span class="text-small">Code Pages Encoding</span>
            <app-string-setting
                [parameter]="descriptor.parameters['codePagesEncoding']"
                [setting]="block.settings['codePagesEncoding']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-3">
    <div class="color-accent-light text-small">
        ADVANCED SETTINGS
    </div>
</div>
<div class="row mt-2">
    <div class="col-6 pl-0 pr-1">
        <div class="mb-1">
            <span class="text-small">HTTP Library</span>
            <app-enum-setting
                [parameter]="descriptor.parameters['httpLibrary']"
                [setting]="block.settings['httpLibrary']"
                (onChange)="valueChanged()" />
        </div>
    </div>
    <div class="col-6 pr-0 pl-1">
        <div class="mb-1">
            <span class="text-small">Security Protocol</span>
            <app-enum-setting
                [parameter]="descriptor.parameters['securityProtocol']"
                [setting]="block.settings['securityProtocol']"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12 px-0">
        <div class="mb-1">
            <app-bool-setting
                [parameter]="descriptor.parameters['useCustomCipherSuites']"
                [setting]="block.settings['useCustomCipherSuites']"
                [stacker]="stacker"
                (onChange)="useCustomCipherSuitesChanged()" />
        </div>
    </div>
</div>
<div class="row mt-2" *ngIf="useCustomCipherSuites">
    <div class="col-12 px-0">
        <div class="mb-1">
            <span class="text-small">Custom cipher suites</span>
            <app-list-of-strings-setting
                [parameter]="descriptor.parameters['customCipherSuites']"
                [setting]="block.settings['customCipherSuites']"
                [stacker]="stacker"
                (onChange)="valueChanged()" />
        </div>
    </div>
</div>
